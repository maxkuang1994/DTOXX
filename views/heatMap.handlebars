<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Heatmaps</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

      <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    * {
          box-sizing: border-box;
      }

      #map {
          width: 400px;
          height: 300px;
          border: 1px solid black;
      }

      #legend {
          position: relative;
          width: 400px;
          height: 30px;
          margin-top: 10px;
      }

      #legendGradient {
          width: 100%;
          height: 15px;
          border: 1px solid black;
      }

      .bar:hover {
    fill: brown;
  }

  .axis {
    font: 10px sans-serif;
  }

  .axis path,
  .axis line {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

  .x.axis path {
    display: none;
  }

  .d3-tip {
    line-height: 1;
    font-weight: bold;
    padding: 6px;
    background: rgba(0, 0, 0, 0.8);
    color: #fff;
    border-radius: 1px;
  }

  /* Creates a small triangle extender for the tooltip */
  .d3-tip:after {
    box-sizing: border-box;
    display: inline;
    font-size: 6px;
    width: 100%;
    line-height: 1;
    color: rgba(0, 0, 0, 0.8);
    content: "\25BC";
    position: absolute;
    text-align: center;
  }

  /* Style northward tooltips differently */
  .d3-tip.n:after {
    margin: -1px 0 0 0;
    top: 100%;
    left: 0;
  }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>
    <script>
// Adding 500 Data Points
var map, pointarray, heatmap;
//var myLatLng = new google.maps.LatLng(33.150987, -117.277763);

var crashData = [
{location:  new google.maps.LatLng( 32.844,-116.7568664 ), weight:  49.8  },
{location:  new google.maps.LatLng( 32.799299,-116.9532165  ), weight:  56.8  },
{location:  new google.maps.LatLng( 32.8019979,-116.867176  ), weight:  121.3 },
{location:  new google.maps.LatLng( 32.7161115,-116.8722585 ), weight:  42.3  },
{location:  new google.maps.LatLng( 32.7698494,-117.0177946 ), weight:  189.5 },
{location:  new google.maps.LatLng( 32.8503264,-116.9098894 ), weight:  110.7 },
{location:  new google.maps.LatLng( 32.7326733,-117.038919  ), weight:  144.9 },
{location:  new google.maps.LatLng( 32.7382744,-116.3960005 ), weight:  48.9  },
{location:  new google.maps.LatLng( 32.8592325,-116.988263  ), weight:  42  },
{location:  new google.maps.LatLng( 32.7294384,-116.9794295 ), weight:  76.7  },
{location:  new google.maps.LatLng( 32.9585454,-117.2636194 ), weight:  58.4  },
{location:  new google.maps.LatLng( 32.8035347,-117.0349292 ), weight:  72.1  },
{location:  new google.maps.LatLng( 32.827887,-117.1461504  ), weight:  8 },
{location:  new google.maps.LatLng( 32.868788,-117.1531511  ), weight:  120.8 },
{location:  new google.maps.LatLng( 32.8695636,-117.2073419 ), weight:  68.2  },
{location:  new google.maps.LatLng( 33.202577,-117.367068 ), weight:  54.9  },
{location:  new google.maps.LatLng( 33.1215195,-117.287719  ), weight:  75.8  },
{location:  new google.maps.LatLng( 33.2259755,-117.3175415 ), weight:  18  },
{location:  new google.maps.LatLng( 33.3220441,-117.317228  ), weight:  71.6  },
{location:  new google.maps.LatLng( 33.0037625,-117.2331358 ), weight:  65.7  },
{location:  new google.maps.LatLng( 33.184998,-117.2404705  ), weight:  75  },
{location:  new google.maps.LatLng( 32.9226655,-117.072944  ), weight:  157.7 },
{location:  new google.maps.LatLng( 33.100492,-116.301327 ), weight:  90.8  },
{location:  new google.maps.LatLng( 33.1347254,-117.0699775 ), weight:  114.2 },
{location:  new google.maps.LatLng( 33.3663111,-117.214997  ), weight:  53.5  },
{location:  new google.maps.LatLng( 32.8245525,-117.0951632 ), weight:  239.3 },
{location:  new google.maps.LatLng( 33.0740404,-116.587176  ), weight:  174.3 },
{location:  new google.maps.LatLng( 33.3033679,-116.9814167 ), weight:  24.3  },
{location:  new google.maps.LatLng( 32.9967799,-117.0124775 ), weight:  91.8  },
{location:  new google.maps.LatLng( 33.0253775,-116.8255691 ), weight:  54.5  },
{location:  new google.maps.LatLng( 33.1344508,-117.1703079 ), weight:  132.9 },
{location:  new google.maps.LatLng( 33.226128,-117.0206735  ), weight:  53.4  },
{location:  new google.maps.LatLng( 32.6317664,-117.0208791 ), weight:  97.2  },
{location:  new google.maps.LatLng( 32.6926616,-117.2063  ), weight:  73.7  },
{location:  new google.maps.LatLng( 32.669864,-117.0895853  ), weight:  40.8  },
{location:  new google.maps.LatLng( 32.5841728,-117.0429 ), weight:  31  },
{location:  new google.maps.LatLng( 32.6349965,-117.0846095 ), weight:  9 }
];

  var gradient;

function initialize() {
  var mapOptions = {
    zoom: 9,
    center: new google.maps.LatLng(33.062334, -116.55832),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);

  var pointArray = new google.maps.MVCArray(crashData);

  heatmap = new google.maps.visualization.HeatmapLayer({
    data: pointArray
  });

  heatmap.set('opacity',0.85);
  heatmap.set('radius', 42);
  heatmap.setMap(map);

  var styles = [
      {featureType: 'poi.attraction',
       stylers: [{color: '#fce8b2'}]
      },
      {featureType: 'road.highway',
       stylers: [{hue: '#0277bd'}, {saturation: -50}]
      },
      {featureType: 'road.highway',
       elementType: 'labels.icon',
       stylers: [{hue: '#000'}, {saturation: 100}, {lightness: 50}]
      },
      {featureType: 'landscape',
       stylers: [{hue: '#259b24'}, {saturation: 10}, {lightness: -22}]
      }
  ];

  map.setOptions({styles: styles});

  var iconBase = 'https://maps.google.com/mapfiles/kml/pal2/icon39.png';
var marker1 = new google.maps.Marker({  position: new google.maps.LatLng( 32.844,-116.7568664   ),  title: "  Alpine  : 49.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker2 = new google.maps.Marker({  position: new google.maps.LatLng( 32.799299,-116.9532165  ),  title: "  El Cajon  : 56.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker3 = new google.maps.Marker({  position: new google.maps.LatLng( 32.8019979,-116.867176  ),  title: "  Harbison Crest  : 121.3 ",  map: map,icon: iconBase, opacity: 0 });
var marker4 = new google.maps.Marker({  position: new google.maps.LatLng( 32.7161115,-116.8722585 ),  title: "  Jamul : 42.3  ",  map: map,icon: iconBase, opacity: 0 });
var marker5 = new google.maps.Marker({  position: new google.maps.LatLng( 32.7698494,-117.0177946 ),  title: "  La Mesa : 189.5 ",  map: map,icon: iconBase, opacity: 0 });
var marker6 = new google.maps.Marker({  position: new google.maps.LatLng( 32.8503264,-116.9098894 ),  title: "  Lakeside  : 110.7 ",  map: map,icon: iconBase, opacity: 0 });
var marker7 = new google.maps.Marker({  position: new google.maps.LatLng( 32.7326733,-117.038919  ),  title: "  Lemon Grove : 144.9 ",  map: map,icon: iconBase, opacity: 0 });
var marker8 = new google.maps.Marker({  position: new google.maps.LatLng( 32.7382744,-116.3960005 ),  title: "  Mountain Empire : 48.9  ",  map: map,icon: iconBase, opacity: 0 });
var marker9 = new google.maps.Marker({  position: new google.maps.LatLng( 32.8592325,-116.988263  ),  title: "  Santee  : 42  ",  map: map,icon: iconBase, opacity: 0 });
var marker10  = new google.maps.Marker({  position: new google.maps.LatLng( 32.7294384,-116.9794295 ),  title: "  Spring Valley : 76.7  ",  map: map,icon: iconBase, opacity: 0 });
var marker11  = new google.maps.Marker({  position: new google.maps.LatLng( 32.9585454,-117.2636194 ),  title: "  Del Mar-Mira Mesa : 58.4  ",  map: map,icon: iconBase, opacity: 0 });
var marker12  = new google.maps.Marker({  position: new google.maps.LatLng( 32.8035347,-117.0349292 ),  title: "  Elliott-Navajo  : 72.1  ",  map: map,icon: iconBase, opacity: 0 });
var marker13  = new google.maps.Marker({  position: new google.maps.LatLng( 32.827887,-117.1461504  ),  title: "  Kearny Mesa : 8 ",  map: map,icon: iconBase, opacity: 0 });
var marker14  = new google.maps.Marker({  position: new google.maps.LatLng( 32.868788,-117.1531511  ),  title: "  Miramar : 120.8 ",  map: map,icon: iconBase, opacity: 0 });
var marker15  = new google.maps.Marker({  position: new google.maps.LatLng( 32.8695636,-117.2073419 ),  title: "  University  : 68.2  ",  map: map,icon: iconBase, opacity: 0 });
var marker16  = new google.maps.Marker({  position: new google.maps.LatLng( 33.202577,-117.367068   ),  title: "  North Coastal Region  : 54.9  ",  map: map,icon: iconBase, opacity: 0 });
var marker17  = new google.maps.Marker({  position: new google.maps.LatLng( 33.1215195,-117.287719  ),  title: "  Carlsbad  : 75.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker18  = new google.maps.Marker({  position: new google.maps.LatLng( 33.2259755,-117.3175415 ),  title: "  Oceanside : 18  ",  map: map,icon: iconBase, opacity: 0 });
var marker19  = new google.maps.Marker({  position: new google.maps.LatLng( 33.3220441,-117.317228  ),  title: "  Pendleton : 71.6  ",  map: map,icon: iconBase, opacity: 0 });
var marker20  = new google.maps.Marker({  position: new google.maps.LatLng( 33.0037625,-117.2331358 ),  title: "  San Dieguito  : 65.7  ",  map: map,icon: iconBase, opacity: 0 });
var marker21  = new google.maps.Marker({  position: new google.maps.LatLng( 33.184998,-117.2404705  ),  title: "  Vista : 75  ",  map: map,icon: iconBase, opacity: 0 });
var marker22  = new google.maps.Marker({  position: new google.maps.LatLng( 32.9226655,-117.072944  ),  title: "  North Inland Region : 157.7 ",  map: map,icon: iconBase, opacity: 0 });
var marker23  = new google.maps.Marker({  position: new google.maps.LatLng( 33.100492,-116.301327   ),  title: "  Anza-Borrego Springs  : 90.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker24  = new google.maps.Marker({  position: new google.maps.LatLng( 33.1347254,-117.0699775 ),  title: "  Escondido : 114.2 ",  map: map,icon: iconBase, opacity: 0 });
var marker25  = new google.maps.Marker({  position: new google.maps.LatLng( 33.3663111,-117.214997  ),  title: "  Fallbrook : 53.5  ",  map: map,icon: iconBase, opacity: 0 });
var marker26  = new google.maps.Marker({  position: new google.maps.LatLng( 32.8245525,-117.0951632 ),  title: "  North San Diego : 239.3 ",  map: map,icon: iconBase, opacity: 0 });
var marker27  = new google.maps.Marker({  position: new google.maps.LatLng( 33.0740404,-116.587176  ),  title: "  Palomar-Julian  : 174.3 ",  map: map,icon: iconBase, opacity: 0 });
var marker28  = new google.maps.Marker({  position: new google.maps.LatLng( 33.3033679,-116.9814167 ),  title: "  Pauma : 24.3  ",  map: map,icon: iconBase, opacity: 0 });
var marker29  = new google.maps.Marker({  position: new google.maps.LatLng( 32.9967799,-117.0124775 ),  title: "  Poway : 91.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker30  = new google.maps.Marker({  position: new google.maps.LatLng( 33.0253775,-116.8255691 ),  title: "  Ramona  : 54.5  ",  map: map,icon: iconBase, opacity: 0 });
var marker31  = new google.maps.Marker({  position: new google.maps.LatLng( 33.1344508,-117.1703079 ),  title: "  San Marcos  : 132.9 ",  map: map,icon: iconBase, opacity: 0 });
var marker32  = new google.maps.Marker({  position: new google.maps.LatLng( 33.226128,-117.0206735  ),  title: "  Valley Center : 53.4  ",  map: map,icon: iconBase, opacity: 0 });
var marker33  = new google.maps.Marker({  position: new google.maps.LatLng( 32.6317664,-117.0208791 ),  title: "  Chula Vista : 97.2  ",  map: map,icon: iconBase, opacity: 0 });
var marker34  = new google.maps.Marker({  position: new google.maps.LatLng( 32.6926616,-117.2063    ),  title: "  Coronado  : 73.7  ",  map: map,icon: iconBase, opacity: 0 });
var marker35  = new google.maps.Marker({  position: new google.maps.LatLng( 32.669864,-117.0895853  ),  title: "  National City : 40.8  ",  map: map,icon: iconBase, opacity: 0 });
var marker36  = new google.maps.Marker({  position: new google.maps.LatLng( 32.5841728,-117.0429  ),  title: "  South Bay : 31  ",  map: map,icon: iconBase, opacity: 0 });
var marker37  = new google.maps.Marker({  position: new google.maps.LatLng( 32.6349965,-117.0846095 ),  title: "  Sweetwater  : 9 ",  map: map,icon: iconBase, opacity: 0 });
} //end initialize function


function toggleHeatmap() {
  heatmap.setMap(heatmap.getMap() ? null : map);
}

function changeGradient() {
  var gradient = [
    'rgba(0, 255, 255, 0)',
    'rgba(0, 255, 255, 1)',
    'rgba(0, 191, 255, 1)',
    'rgba(0, 127, 255, 1)',
    'rgba(0, 63, 255, 1)',
    'rgba(0, 0, 255, 1)',
    'rgba(0, 0, 223, 1)',
    'rgba(0, 0, 191, 1)',
    'rgba(0, 0, 159, 1)',
    'rgba(0, 0, 127, 1)',
    'rgba(3, 0, 191, 1)',
    'rgba(27, 0, 163, 1)',
    'rgba(41, 0, 131, 1)',
    'rgba(55, 0, 10, 1)'
  ]
  heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
}

function changeRadius() {
  heatmap.set('radius', heatmap.get('radius') ? null : 42);
}

function changeOpacity() {
  heatmap.set('opacity', heatmap.get('opacity') ? null : 0.85);
}

google.maps.event.addDomListener(window, 'load', initialize);



    </script>
  </head>

  <body>
    <div id="panel">
      <button onclick="toggleHeatmap()">Toggle Heatmap</button>
      <button onclick="changeGradient()">Change gradient</button>
      <button onclick="changeRadius()">Change radius</button>
      <button onclick="changeOpacity()">Change opacity</button>
 <script type="text/javascript">
       
        </script>

    </div>

    <div style = "background-color: transparent">
      <script>
      var margin = {top: 20, right: 20, bottom: 100, left: 40};
  var width = 960 - margin.left - margin.right;
  var height = 350 - margin.top - margin.bottom;

  //define scale of x to be from 0 to width of SVG, with .1 padding in between
  var scaleX = d3.scale.ordinal()
    .rangeRoundBands([0, width], .1);

  //define scale of y to be from the height of SVG to 0
  var scaleY = d3.scale.linear()
    .range([height, 0]);

  //define axes
  var xAxis = d3.svg.axis()
    .scale(scaleX)
    .orient("bottom");

  var yAxis = d3.svg.axis()
    .scale(scaleY)
    .orient("left");

  //create a tip
  var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .html(function(d) {
      return "<strong>collision rate:</strong> <span style='color:red'>" + d.frequency + "</span>";
    })

  //create svg

    //var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13, 11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ];

  var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  svg.call(tip);

  //get json object which contains media counts
d3.tsv("fonts/data.tsv", type, function(error, data) {
  scaleX.domain(data.map(function(d) { return d.letter; }));
  scaleY.domain([0, d3.max(data, function(d) { return d.frequency; })]);

    //set up x axis
    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")") //move x-axis to the bottom
      .call(xAxis)
      .selectAll("text")  
      .style("text-anchor", "end")
      .attr("dx", "-.8em")
      .attr("dy", ".15em")
      .attr("transform", function(d) {
        return "rotate(-65)" 
      });

    //set up y axis
    svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("rate");

    //set up bars in bar graph
    svg.selectAll(".bar")
      .data(data)
      .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return scaleX(d.letter); })
      .attr("width", scaleX.rangeBand())
      .attr("y", function(d) { return scaleY(d.frequency); })
      .attr("height", function(d) { return height - scaleY(d.frequency); })
      //.attr("fill", function(d) { return "rgb(0, 0, " + (d * 10)%255 + ")";})
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide)
        .attr("fill", function(d) {
    return "rgb(" + ( parseInt(d.frequency*1.5, 10)) + ", "+ (255-parseInt(d.frequency*1.5, 10) )+", 100)";
    });

    d3.select("input").on("change", change);

    var sortTimeout = setTimeout(function() {
      d3.select("input").property("checked", true).each(change);
    }, 2000);

    function change() {
      clearTimeout(sortTimeout);

      // Copy-on-write since tweens are evaluated after a delay.
      var x0 = scaleX.domain(data.sort(this.checked
          ? function(a, b) { return b.frequency - a.frequency; }
          : function(a, b) { return d3.ascending(a.letter, b.letter); })
          .map(function(d) { return d.letter; }))
          .copy();

      svg.selectAll(".bar")
          .sort(function(a, b) { return x0(a.letter) - x0(b.letter); });

      var transition = svg.transition().duration(750),
          delay = function(d, i) { return i * 50; };

      transition.selectAll(".bar")
          .delay(delay)
          .attr("x", function(d) { return x0(d.letter); });

      transition.select(".x.axis")
          .call(xAxis)
        .selectAll("g")
          .delay(delay);
    }
  });

function type(d) {
  d.frequency = +d.frequency;
  return d;
}

</script>
</div>

    <div id="map-canvas"></div>
  </body>
</html>